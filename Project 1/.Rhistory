setwd("C:/Users/janna/Documents/Merrimack MSDS/DSE5004/Project 1")
library(tidyverse)
library(caret)
library(writexl)
data <- read.csv("data/Customer_Dataset_Data.csv", na.strings = "?", stringsAsFactors = F)
data <- data %>% column_to_rownames(., var = "CustomerID")
# Drop irrelevant columns
data <- data[, -c(7,18,19,20,21,23,24,25,26,27,28,29,30,31,32)]
# Convert monetary columns from character to numeric
data$VoiceOverTenure <- parse_number(data$VoiceOverTenure)
data$VoiceLastMonth <- parse_number(data$VoiceLastMonth)
data$EquipmentOverTenure <- parse_number(data$EquipmentOverTenure)
data$EquipmentLastMonth <- parse_number(data$EquipmentLastMonth)
data$DataOverTenure <- parse_number(data$DataOverTenure)
data$DataLastMonth <- parse_number(data$DataLastMonth)
# Convert null values in monetary columns to 0
data$VoiceOverTenure[is.na(data$VoiceOverTenure)] <- 0
data$VoiceLastMonth[is.na(data$VoiceLastMonth)] <- 0
data$EquipmentOverTenure[is.na(data$EquipmentOverTenure)] <- 0
data$EquipmentLastMonth[is.na(data$EquipmentLastMonth)] <- 0
data$DataOverTenure[is.na(data$DataOverTenure)] <- 0
data$DataLastMonth[is.na(data$DataLastMonth)] <- 0
View(data)
data$HHIncome <- parse_number(data$HHIncome)
data$TotalOverTenure <- data$VoiceOverTenure + data$EquipmentOverTenure + data$DataOverTenure
data$TotalByTenure <- data$TotalOverTenure / data$PhoneCoTenure
data$TotalLastMonth <- data$VoiceLastMonth + data$EquipmentLastMonth + data$DataLastMonth
?summarise()
data_occupation <- data %>%
group_by(JobCategory) %>%
summarise(avgLastMonth = mean(TotalLastMonth))
View(data_occupation)
a <- ggplot(data = data_occupation) +
geom_col(aes(x=JobCategory, y=avgLastMonth))
print(a)
b <- ggplot(data = data) +
geom_histogram(aes(x=Age), bins=30)
print(b)
b <- ggplot(data = data) +
geom_histogram(aes(x=Age), bins=100)
print(b)
b <- ggplot(data = data) +
geom_histogram(aes(x=Age), bins=50)
print(b)
b <- ggplot(data = data) +
geom_histogram(aes(x=Age), bins=30)
print(b)
?geom_histogram
b <- ggplot(data = data) +
geom_histogram(aes(x=Age), bins=30, color = "black", fill = "blue")
print(b)
c <- ggplot(data = data) +
geom_point(aes(x=PhoneCoTenure, y=TotalLastMonth), color = "lightblue")
print(c)
library(tidyverse)
library(ggplot2)
#load data
df <- read_csv("data/titanic.csv")
library(tidyverse)
library(ggplot2)
#load data
df <- read_csv("data/titanic.csv")
g <- ggplot(data=df) + geom_histogram(aes(x=Fare))
print(g)
g <- ggplot(data=df) + geom_histogram(aes(x=Pclass))
print(g)
df$FareGroup <- cut(df$Fare, breaks=c(-1,30, 75,600), labels=c("Low","Medium","High"))
View(df)
?cut()
df <- df %>% mutate(segment = case_when(
FareGroup == "Low" & Sex == "male" ~ 1,
FareGroup == "Medium" & Sex == "male" ~ 2,
FareGroup == "High" & Sex == "male" ~ 3,
FareGroup == "Low" & Sex != "male" ~ 4,
FareGroup == "Medium" & Sex != "male" ~ 5,
TRUE ~ 6
))
df %>% write_csv("output_of_segmentation.csv")
df %>% add_count(segment) %>%
group_by(segment,n) %>%
summarise_all("mean")
df %>% select(-c("Name","Sex","FareGroup")) %>% add_count(segment) %>%
group_by(segment,n) %>%
summarise_all("mean")
g <- ggplot(df)+geom_point(aes(x=Fare,y=Age,colour=as.factor(segment)))
print(g)
data_equip <- data %>%
add_count(EquipmentRental) %>%
group_by(EquipmentRental,n) %>%
summarise(avgLastMonth = mean(TotalLastMonth))
View(data_equip)
d <- ggplot(data = data %>% filter(EquipmentRental == "Yes")) +
geom_histogram(aes(x=Age), color="black", fill="yellow", bins=30)
print(d)
data_wireless <- data %>%
add_count(EquipmentRental) %>%
group_by(EquipmentRental,n) %>%
summarise(avgLastMonth = mean(TotalLastMonth))
View(data_wireless)
data_wireless <- data %>%
add_count(WirelessData) %>%
group_by(WirelessData,n) %>%
summarise(avgLastMonth = mean(TotalLastMonth))
View(data_wireless)
data <- data %>% mutate(segment = case_when(
EquipmentRental == "Yes" & WirelessData == "Yes" ~ 1,
EquipmentRental == "Yes" & WirelessData == "No" ~ 2,
EquipmentRental == "No" & WirelessData == "Yes" ~ 3,
EquipmentRental == "No" & WirelessData == "No" ~ 4,
))
data$CardSpendMonth <- parse_number(data$CardSpendMonth)
data$CardSpendMonth[is.na(data$CardSpendMonth)] <- 0
data %>% add_count(segment) %>%
group_by(segment,n) %>%
select_if(is.numeric) %>%
summarise_all("mean")
data_segmented <- data %>% add_count(segment) %>%
group_by(segment,n) %>%
select_if(is.numeric) %>%
summarise_all("mean")
View(data_segmented)
data_segmented <- data %>% add_count(segment) %>%
group_by(segment,n) %>%
select_if(is.numeric) %>%
summarise_all("median")
e <- ggplot(data = data) +
geom_histogram(aes(x=PhoneCoTenure), color="black", fill="darkred")
print(e)
e <- ggplot(data = data) +
geom_histogram(aes(x=PhoneCoTenure), color="black", fill="darkred") +
geom_vline(xintercept = mean(data$PhoneCoTenure), color="blue")
print(e)
original_data <- read.csv("data/Customer_Dataset_Data.csv", na.strings = "?", stringsAsFactors = F)
original_data <- original_data %>% column_to_rownames(., var = "CustomerID")
data <- original_data
# Drop irrelevant columns
data <- data[, -c(7,18,19,20,21,23,24,25,26,27,28,29,30,31,32)]
# Convert monetary columns from character to numeric
data$VoiceOverTenure <- parse_number(data$VoiceOverTenure)
data$VoiceLastMonth <- parse_number(data$VoiceLastMonth)
data$EquipmentOverTenure <- parse_number(data$EquipmentOverTenure)
data$EquipmentLastMonth <- parse_number(data$EquipmentLastMonth)
data$DataOverTenure <- parse_number(data$DataOverTenure)
data$DataLastMonth <- parse_number(data$DataLastMonth)
data$CardSpendMonth <- parse_number(data$CardSpendMonth)
?ifelse()
data$VoiceOverTenure[is.na(data$VoiceOverTenure)] <- median(data$VoiceOverTenure)
data$VoiceLastMonth[is.na(data$VoiceLastMonth)] <- median(data$VoiceLastMonth)
data$EquipmentOverTenure[is.na(data$EquipmentOverTenure)] <- ifelse(data$EquipmentRental=="Yes",
median(data$EquipmentOverTenure),
0)
data$EquipmentLastMonth[is.na(data$EquipmentLastMonth)] <- ifelse(data$EquipmentRental=="Yes",
median(data$EquipmentLastMonth),
0)
data$DataOverTenure[is.na(data$DataOverTenure)] <- ifelse(data$WirelessData=="Yes",
median(data$DataOverTenure),
0)
data$DataLastMonth[is.na(data$DataLastMonth)] <- ifelse(data$WirelessData=="Yes",
median(data$DataLastMonth),
0)
data$CardSpendMonth[is.na(data$CardSpendMonth)] <- median(data$CardSpendMonth)
data$VoiceOverTenure <- replace_na(data$VoiceOverTenure, median(data$VoiceOverTenure))
data$VoiceLastMonth <- replace_na(data$VoiceLastMonth, median(data$VoiceLastMonth))
data$EquipmentOverTenure <- replace_na(data$EquipmentOverTenure, ifelse(data$EquipmentRental="Yes",
data$EquipmentOverTenure <- replace_na(data$EquipmentOverTenure, ifelse(data$EquipmentRental=="Yes",
median(data$EquipmentOverTenure),
0))
data <- replace_na(data, "EquipmentOverTenure", "EquipmentLastMonth")
handle_na <- function(data, col1, col2) {
med_val <- median(data[[col1]], na.rm = TRUE)  # Calculate median of Column 1
for (i in 1:nrow(data)) {
if (is.na(data[i, col1])) {
if (data[i, col2] == "Yes") {
data[i, col1] <- med_val
} else {
data[i, col1] <- 0
}
}
}
return(data)
}
data <- handle_na(data, "EquipmentOverTenure", "EquipmentLastMonth")
data <- handle_na(data, "EquipmentOverTenure", "EquipmentRental")
data <- handle_na(data, "EquipmentLastMonth", "EquipmentRental")
data <- handle_na(data, "DataOverTenure", "WirelessData")
data <- handle_na(data, "DataLastMonth", "WirelessData")
data$HHIncome <- parse_number(data$HHIncome)
data$TotalOverTenure <- data$VoiceOverTenure + data$EquipmentOverTenure + data$DataOverTenure
data$TotalByTenure <- data$TotalOverTenure / data$PhoneCoTenure
data$TotalLastMonth <- data$VoiceLastMonth + data$EquipmentLastMonth + data$DataLastMonth
data$LogIncome <- log10(data$HHIncome)
data$LogTotalLastMonth <- log10(data$TotalLastMonth)
f <- ggplot(data = data) +
geom_point(aes(x=LogIncome, y=LogTotalLastMonth), color="blue")
print(f)
cor(data$LogIncome, data$LogTotalLastMonth)
g <- ggplot(data = data) +
geom_col(aes(x=Age, y=TVWatchingHours), color="black", fill="forestgreen")
print(g)
g <- ggplot(data = data) +
geom_col(aes(x=Age, y=TVWatchingHours), fill="forestgreen")
print(g)
g <- ggplot(data = data %>% select(Age, TVWatchingHours) %>%
group_by(Age) %>%
summarise(AvgTVHours = mean(TVWatchingHours))) +
geom_col(aes(x=Age, y=AvgTVHours), fill="forestgreen")
print(g)
h <- ggplot(data = data) +
geom_histogram(aes(x=TotalLastMonth), color="black", fill="yellow")
print(h)
h <- ggplot(data = data) +
geom_histogram(aes(x=TotalLastMonth), color="black", fill="yellow") +
geom_vline(xintercept=median(TotalLastMonth))
h <- ggplot(data = data) +
geom_histogram(aes(x=TotalLastMonth), color="black", fill="yellow") +
geom_vline(xintercept=median(data$TotalLastMonth), color="blue")
print(h)
h <- ggplot(data = data) +
geom_histogram(aes(x=TotalLastMonth), color="black", fill="yellow") +
geom_vline(xintercept=mean(data$TotalLastMonth), color="blue") +
annotate(geom="text", x=100, y=1200, label=as.character(mean(data$TotalLastMonth)))
print(h)
i <- ggplot(data = data) +
geom_histogram(aes(x=CardSpendMonth), color="black", fill="lightgreen") +
geom_vline(xintercept=mean(data$CardSpendMonth), color="blue") +
annotate(geom="text", x=100, y=1200, label=as.character(mean(data$CardSpendMonth)))
print(h)
i <- ggplot(data = data) +
geom_histogram(aes(x=CardSpendMonth), color="black", fill="lightgreen") +
geom_vline(xintercept=mean(data$CardSpendMonth), color="blue") +
annotate(geom="text", x=100, y=1200, label=as.character(mean(data$CardSpendMonth)))
print(i)
i <- ggplot(data = data) +
geom_histogram(aes(x=CardSpendMonth), color="black", fill="lightgreen") +
geom_vline(xintercept=mean(data$CardSpendMonth, na.rm = T), color="blue") +
annotate(geom="text", x=100, y=1200, label=as.character(mean(data$CardSpendMonth, na.rm = T)))
print(i)
?where()
?which()
which(data$CardSpendMonth == 0)
mean(data$CardSpendMonth)
which(is.na(data$CardSpendMonth))
mean(data$CardSpendMonth, na.rm =T)
i <- ggplot(data = data) +
geom_histogram(aes(x=CardSpendMonth), color="black", fill="lightgreen") +
geom_vline(xintercept=mean(data$CardSpendMonth, na.rm = T), color="blue") +
annotate(geom="text", x=100, y=1200, label=as.character(mean(data$CardSpendMonth, na.rm = T)))
print(i)
i <- ggplot(data = data) +
geom_histogram(aes(x=CardSpendMonth), color="black", fill="lightgreen") +
geom_vline(xintercept=mean(data$CardSpendMonth, na.rm = T), color="blue") +
scale_x_continuous(breaks = seq(0, 40000, by=2500))
print(i)
j <- ggplot(data = data) +
geom_histogram(aes(x=PhoneCoTenure), color="black", fill="lightblue") +
geom_line(xintercept=mean(data$PhoneCoTenure), na.rm = T, color="blue")
print(j)
j <- ggplot(data = data) +
geom_histogram(aes(x=PhoneCoTenure), color="black", fill="lightblue") +
geom_vline(xintercept=mean(data$PhoneCoTenure), na.rm = T, color="blue")
print(j)
data$LastMonthGroup <- cut(data$TotalLastMonth, breaks=c(-1,70,600), labels=c("Low", "High"))
data$CardSpendGroup <- cut(data$CardSpendMonth, breaks=c(-1,5000,40000), labels=c("Low", "High"))
data$TenureGroup <- cut(data$CardSpendMonth, breaks=c(-1,40,100), labels=c("Short", "Long"))
?kmeans()
